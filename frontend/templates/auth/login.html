{% extends "base.html" %}
{% block title %}Iniciar sesiÃ³n{% endblock %}

{% block content %}
<div class="auth-page">
  <div class="auth-card">
    <div class="auth-logo">ğŸ­</div>
    <h1 class="auth-titulo">Iniciar sesiÃ³n</h1>
    <p class="auth-subtitulo">Bienvenido de vuelta a Carnavalix</p>

    <form class="auth-form" id="loginForm" autocomplete="on">
      <div class="auth-field">
        <label for="username">Usuario</label>
        <input type="text" id="username" name="username" placeholder="tu_usuario" autocomplete="username" required />
      </div>
      <div class="auth-field">
        <label for="password">ContraseÃ±a</label>
        <div class="auth-pass-wrap">
          <input type="password" id="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" required />
          <button type="button" class="btn-ver-pass" id="btnVerPass" tabindex="-1">ğŸ‘</button>
        </div>
      </div>
      <div class="auth-error" id="loginError" style="display:none"></div>
      <button type="submit" class="btn-auth-primary" id="btnLogin">Entrar</button>
    </form>

    <div class="auth-divider">Â¿No tienes cuenta?</div>
    <a href="/registro" class="btn-auth-secondary">Crear cuenta gratis</a>
    <a href="/" class="auth-skip">Continuar sin cuenta â†’</a>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const btn = document.getElementById("btnLogin");
  const errEl = document.getElementById("loginError");
  btn.disabled = true;
  btn.textContent = "Entrando...";
  errEl.style.display = "none";

  try {
    const res = await fetch("/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: document.getElementById("username").value.trim(),
        password: document.getElementById("password").value,
        recordar: true,
      }),
    });
    const data = await res.json();
    if (data.ok) {
      window.location.href = new URLSearchParams(location.search).get("next") || "/";
    } else {
      errEl.textContent = data.error || "Error al iniciar sesiÃ³n";
      errEl.style.display = "block";
      btn.disabled = false;
      btn.textContent = "Entrar";
    }
  } catch {
    errEl.textContent = "Error de conexiÃ³n";
    errEl.style.display = "block";
    btn.disabled = false;
    btn.textContent = "Entrar";
  }
});

document.getElementById("btnVerPass").addEventListener("click", () => {
  const inp = document.getElementById("password");
  inp.type = inp.type === "password" ? "text" : "password";
});
</script>
{% endblock %}
